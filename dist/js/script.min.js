const canvas=document.getElementById("myGame"),ctx=canvas.getContext("2d"),canvasScore=document.querySelector(".canvas__score");class MyGame{constructor(e,t,a){this.canvas=e,this.ctx=t,this.func=a,this.play=setInterval(this.func,10),this.speed=4,this.score=0,this.life=0,this.x=this.canvas.width-20,this.y=this.canvas.height,this.start=!1,this.pause=!0,this.collisionHandler=!1,this.userName="",this.key=new Date,this.imgSrc="./img/hero/newPlayer2.png",this.cameraX=0,this.cameraSpeed=0}startGame(){const e=document.querySelector(".canvas__form");this.pause&&clearInterval(this.play),e.onsubmit=e=>{e.preventDefault(),this.play=setInterval(this.func,10);const t=document.querySelector(".canvas__input"),a=document.querySelector(".canvas__form");this.userName=t.value,a.classList.remove("active")}}collision(e,t){t.x+15+t.frameWidth-25>=e.playerX+95&&t.x+15+t.frameWidth-25<=e.playerX+95+e.frameWidth-195&&t.y+55>=e.playerY-e.jumpHeight+e.frameHeight-80&&t.y+55-t.frameHeight-15<=e.playerY-e.jumpHeight+e.frameHeight-80?(this.collisionHandler=!0,this.imgSrc="./img/hero/hit2.png",this.collisionHandler&&(this.collisionHandler=!1,this.life=this.life-1/16,setTimeout(()=>{this.imgSrc="./img/hero/newPlayer2.png",this.life=Math.floor(this.life)},200))):t.x+15+t.frameWidth-25>=e.playerX+95&&t.x+15<=e.playerX+95&&this.score++}drawBackground(){const e=new Image;e.src="./img/bg1.png";const t=Math.floor(this.cameraX/e.width)*e.width-this.cameraX%e.width,a=Math.ceil(this.canvas.width/1480)+2;this.cameraSpeed++;for(let r=0;r<a;r++)this.ctx.drawImage(e,t+1480*r-this.cameraX,0,1480,this.canvas.height)}drawScore(){this.ctx.font="16px Arial",this.ctx.fillStyle="#fff",this.ctx.fillText("Score: "+this.score,8,20)}drawLife(){const e=new Image,t=new Image;switch(e.src="./img/hearts_hud.png",t.src="./img/no_hearts_hud.png",this.life){case 0:this.ctx.drawImage(e,10,40,25,25),this.ctx.drawImage(e,40,40,25,25),this.ctx.drawImage(e,70,40,25,25);case-1:this.ctx.drawImage(e,10,40,25,25),this.ctx.drawImage(e,40,40,25,25),this.ctx.drawImage(t,70,40,25,25);case-2:this.ctx.drawImage(e,10,40,25,25),this.ctx.drawImage(t,40,40,25,25),this.ctx.drawImage(t,70,40,25,25);case-3:this.ctx.drawImage(t,10,40,25,25),this.ctx.drawImage(t,40,40,25,25),this.ctx.drawImage(t,70,40,25,25)}}}class Player extends MyGame{constructor(){super(canvas,ctx),this.canvas=canvas,this.ctx=ctx,this.width=50,this.height=70,this.jumpCount=0,this.jumpLength=45,this.jumpHeight=0,this.upPressed=!1,this.downPressed=!1,this.playerX=(this.canvas.width-this.width)/5,this.playerY=this.canvas.height-80,this.numColumns=6,this.numRows=8,this.frameWidth=1500/this.numColumns,this.frameHeight=784/this.numRows,this.currentFrame=0}drawPlayer(){const e=new Image;e.src=myGame.imgSrc,this.currentFrame++;let t=this.numColumns*this.numRows-1;this.currentFrame>t&&(this.currentFrame=0);let a=this.currentFrame%this.numColumns,r=Math.floor(this.currentFrame/this.numColumns);this.downPressed&&!this.upPressed?(myGame.imgSrc="./img/hero/sitdown3.png",this.playerY=this.canvas.height+40-this.frameHeight):(myGame.imgSrc="./img/hero/newPlayer2.png",this.playerY=this.canvas.height-this.height),this.upPressed&&(myGame.imgSrc="./img/hero/Jump2.png",this.jumpCount++,this.jumpHeight=2*this.jumpLength*Math.sin(Math.PI*this.jumpCount/this.jumpLength)),this.jumpCount>this.jumpLength&&(myGame.imgSrc="./img/hero/newPlayer2.png",this.jumpCount=0,this.upPressed=!1,this.jumpHeight=0),this.ctx.drawImage(e,a*this.frameWidth,r*this.frameHeight,this.frameWidth,this.frameHeight,this.playerX,this.playerY-this.jumpHeight,this.frameWidth,this.frameHeight-15)}}class Barrier extends MyGame{constructor(e,t,a,r,i,s){super(canvas,ctx),this.canvas=canvas,this.ctx=ctx,this.width=50,this.height=80,this.x=this.canvas.width+20,this.y=this.canvas.height-s,this.img=new Image,this.imgSrc=e,this.imgWidth=t,this.imgHeight=a,this.numColumns=r,this.numRows=i,this.frameWidth=this.imgWidth/this.numColumns,this.frameHeight=this.imgHeight/this.numRows,this.currentFrame=0}drawBarrier(){this.img.src=this.imgSrc,this.currentFrame++;let e=this.numColumns*this.numRows-1;this.currentFrame>e&&(this.currentFrame=0);let t=this.currentFrame%this.numColumns,a=Math.floor(this.currentFrame/this.numColumns);this.ctx.drawImage(this.img,t*this.frameWidth,a*this.frameHeight,this.frameWidth,this.frameHeight,this.x,this.y,this.frameWidth,this.frameHeight)}}const keyDownHandler=e=>{38==e.keyCode&&(player.upPressed=!0),40==e.keyCode&&(player.downPressed=!0),27==e.keyCode&&(myGame.pause=!0,clearInterval(myGame.play)),13==e.keyCode&&(myGame.pause=!1),32==e.keyCode&&(myGame.pause=!myGame.pause,myGame.pause||(myGame.play=setInterval(draw,10)))},keyUpHandler=e=>{40==e.keyCode&&(player.downPressed=!1)},addUserScore=()=>{canvasScore.classList.add("active");const e=JSON.parse(localStorage.getItem("result")||"[]"),t={name:myGame.userName,score:myGame.score,key:myGame.key};e.push(t);var a;e.sort((a="score",(e,t)=>e[a]>t[a]?-1:1)),localStorage.setItem("result",JSON.stringify(e)),e.forEach((e,t)=>{const a=document.querySelector(".canvas__score-inner"),r=document.createElement("p");t<10&&(r.innerHTML=`${t+1}. ${e.name} - ${e.score}`),t>=10&&e.key==myGame.key&&(r.innerHTML+=`...</br>${t+1}. ${e.name} - ${e.score}`),a.appendChild(r)})},moveBarrier=e=>{e.x-=myGame.speed,e.x<=0&&(e.x=Math.floor(1800*Math.random()+1500)),barrier.x+barrier.width+200>=barrier2.x&&barrier.x-200<=barrier2.x+barrier2.width&&(barrier.x+=300)},draw=()=>{ctx.clearRect(0,0,canvas.width,canvas.height),myGame.startGame(),myGame.drawBackground(),player.drawPlayer(),barrier.drawBarrier(),barrier2.drawBarrier(),moveBarrier(barrier),moveBarrier(barrier2),myGame.drawScore(),myGame.drawLife(),myGame.collision(player,barrier),myGame.collision(player,barrier2),myGame.life<-3&&(clearInterval(myGame.play),addUserScore()),myGame.cameraX=myGame.cameraSpeed-myGame.canvas.width/2},myGame=new MyGame(canvas,ctx,draw),barrier=new Barrier("./img/enemy/1/enemy.png",384,480,6,6,65),barrier2=new Barrier("./img/enemy/1/enemy.png",384,480,6,6,105),player=new Player;document.addEventListener("keydown",keyDownHandler),document.addEventListener("keyup",keyUpHandler);